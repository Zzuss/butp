# SNH页面错误处理功能测试指南

## 🎯 测试目标
验证 `/admin/SNH` 页面的错误处理机制是否正常工作，包括：
- 成功上传的反馈
- 部分失败的处理
- 完全失败的错误显示
- 重试功能
- 用户界面的友好性

## 📋 测试前准备

### 1. 启动开发环境
```bash
# 启动Next.js开发服务器
npm run dev
# 或
yarn dev
```

### 2. 访问测试页面
- 打开浏览器访问: `http://localhost:3000/admin/SNH`
- 确保您有管理员权限

### 3. 准备测试数据文件
项目已提供以下测试文件（位于 `test-data/` 文件夹）：

#### 📁 测试文件说明
| 文件名 | 格式 | 用途 | 预期结果 |
|--------|------|------|----------|
| `snh-test-success.csv` | CSV | 测试完全成功场景 | 绿色Alert，100%成功率 |
| `snh-test-success.xlsx` | Excel | 测试完全成功场景 | 绿色Alert，100%成功率 |
| `snh-test-mixed.csv` | CSV | 测试部分成功场景 | 黄色Alert，部分成功 |
| `snh-test-mixed.xlsx` | Excel | 测试部分成功场景 | 黄色Alert，部分成功 |
| `snh-test-errors.csv` | CSV | 测试错误处理 | 红色Alert，显示错误列表 |
| `snh-test-db-format.csv` | CSV | 测试数据库格式 | 应该正常处理 |

## 🧪 测试场景

### 场景1: 完全成功上传 ✅

**测试文件**: `snh-test-success.csv` 或 `snh-test-success.xlsx`

**测试步骤**:
1. 点击"选择文件"按钮
2. 选择 `snh-test-success.csv`
3. 点击"开始上传"
4. 观察进度条和结果显示

**预期结果**:
- ✅ 显示绿色Alert
- ✅ 成功率显示100%
- ✅ 统计显示：文件总行数6，有效数据行5，成功处理5，失败0
- ✅ 不显示错误详情区域
- ✅ 文件选择被清空
- ✅ 显示成功消息

### 场景2: 部分成功处理 ⚠️

**测试文件**: `snh-test-mixed.csv` 或 `snh-test-mixed.xlsx`

**测试步骤**:
1. 选择 `snh-test-mixed.csv`
2. 上传文件
3. 观察处理结果

**预期结果**:
- ⚠️ 显示黄色Alert（部分成功）
- ⚠️ 显示成功率（约50-70%）
- ⚠️ 统计显示成功和失败数量
- ⚠️ 显示蓝色信息框说明跳过的数据
- ⚠️ 显示红色错误详情区域
- ⚠️ 文件选择保持（用于重试）
- ⚠️ 显示"重试上传"按钮

### 场景3: 处理失败/错误数据 ❌

**测试文件**: `snh-test-errors.csv`

**测试步骤**:
1. 选择 `snh-test-errors.csv`
2. 上传文件
3. 检查错误处理

**预期结果**:
- ❌ 显示红色Alert
- ❌ 成功率很低或为0%
- ❌ 显示详细错误列表
- ❌ 每个错误有编号和具体描述
- ❌ 显示解决建议
- ❌ 文件选择保持
- ❌ "重试上传"按钮可用

### 场景4: 数据库格式兼容性 📊

**测试文件**: `snh-test-db-format.csv`

**测试步骤**:
1. 选择 `snh-test-db-format.csv`
2. 上传文件（包含created_at列）
3. 验证处理结果

**预期结果**:
- ✅ 正常处理数据库格式
- ✅ 忽略created_at列
- ✅ 成功处理student_number和student_hash列

### 场景5: 重试功能测试 🔄

**前提条件**: 先执行场景2或场景3，确保有失败记录

**测试步骤**:
1. 在有错误的上传结果页面
2. 点击"重试上传"按钮
3. 观察重试过程和结果

**预期结果**:
- 🔄 显示"重试中..."状态
- 🔄 进度条重新开始
- 🔄 如果网络正常，应该得到相同结果
- 🔄 重试消息中包含"重试完成"或"重试成功"

### 场景6: 网络错误模拟 🌐

**测试方法**: 
1. 断开网络连接或停止后端服务
2. 尝试上传任意文件
3. 观察错误处理

**预期结果**:
- 🌐 显示网络错误信息
- 🌐 提供具体的故障排除建议
- 🌐 区分网络错误和数据错误

### 场景7: 大文件处理 📦

**测试方法**:
1. 创建包含大量记录的CSV文件（如1000行）
2. 上传并观察处理过程

**预期结果**:
- 📦 进度条正常显示
- 📦 能够处理大量数据
- 📦 统计信息准确

## 🔍 用户界面检查点

### ✅ 成功状态检查
- [ ] 绿色Alert显示
- [ ] CheckCircle图标显示
- [ ] 成功率100%
- [ ] 绿色进度条
- [ ] 统计信息准确
- [ ] 文件选择被清空

### ⚠️ 部分成功状态检查  
- [ ] 黄色Alert显示
- [ ] 警告图标（黄色感叹号）显示
- [ ] 成功率在0-100%之间
- [ ] 黄色进度条
- [ ] 显示蓝色跳过数据说明
- [ ] 显示红色错误详情
- [ ] 文件选择保持
- [ ] 重试按钮可用

### ❌ 失败状态检查
- [ ] 红色Alert显示
- [ ] XCircle图标显示
- [ ] 成功率接近0%
- [ ] 红色进度条
- [ ] 错误列表有编号
- [ ] 解决建议清晰
- [ ] 重试按钮可用

### 🎨 界面元素检查
- [ ] 进度条动画流畅
- [ ] 错误信息可滚动
- [ ] 按钮状态正确切换
- [ ] 颜色主题一致
- [ ] 文字内容准确

## 🐛 常见问题排查

### 问题1: 上传无响应
**可能原因**:
- 后端服务未启动
- 数据库连接问题
- 文件权限问题

**检查方法**:
- 查看浏览器Network标签
- 检查控制台错误信息
- 验证API响应状态

### 问题2: 错误信息不显示
**可能原因**:
- 前端状态管理问题
- CSS样式问题
- JavaScript错误

**检查方法**:
- 查看浏览器控制台
- 检查React组件状态
- 验证错误数据结构

### 问题3: 重试功能不工作
**可能原因**:
- 文件状态丢失
- 按钮禁用逻辑错误
- 网络持续问题

**检查方法**:
- 确认lastUploadedFile状态
- 检查按钮disabled属性
- 验证网络连接

## 📊 测试报告模板

### 测试结果记录
| 场景 | 文件 | 预期结果 | 实际结果 | 状态 | 备注 |
|------|------|----------|----------|------|------|
| 完全成功 | snh-test-success.csv | 绿色Alert，100%成功 |  | ✅/❌ |  |
| 部分成功 | snh-test-mixed.csv | 黄色Alert，部分成功 |  | ✅/❌ |  |
| 处理失败 | snh-test-errors.csv | 红色Alert，错误列表 |  | ✅/❌ |  |
| DB格式 | snh-test-db-format.csv | 正常处理 |  | ✅/❌ |  |
| 重试功能 | 任意失败场景 | 重试成功 |  | ✅/❌ |  |
| 网络错误 | 断网测试 | 网络错误提示 |  | ✅/❌ |  |

### 总体评估
- **界面友好性**: ⭐⭐⭐⭐⭐
- **错误处理完整性**: ⭐⭐⭐⭐⭐  
- **用户指导清晰度**: ⭐⭐⭐⭐⭐
- **功能稳定性**: ⭐⭐⭐⭐⭐

---

## 🚀 开始测试！

按照以上场景依次测试，验证SNH页面的错误处理机制是否按预期工作。如果发现问题，请记录具体现象和复现步骤。
