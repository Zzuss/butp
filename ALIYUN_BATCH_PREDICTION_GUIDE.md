# 🚀 阿里云批量预测完整指南

## 🎯 功能概述

阿里云批量预测功能允许你：
1. **上传完整年级成绩文件** - 包含多个专业学生的成绩数据
2. **自动专业分组** - 智能识别并按专业分组学生数据
3. **并行预测处理** - 同时对多个专业进行预测，提高效率
4. **结果收集整理** - 统一展示所有专业的预测结果
5. **文件下载导出** - 下载各专业的详细预测结果Excel文件

## 📁 新增的API接口

### 1. 批量预测API
- **路径**: `/api/aliyun-proxy/batch-predict`
- **方法**: POST
- **功能**: 处理包含多专业的成绩文件，按专业分组后分别调用阿里云预测

### 2. 结果下载API
- **路径**: `/api/aliyun-proxy/download-result`
- **方法**: POST
- **功能**: 将预测结果转换为Excel文件提供下载

### 3. 测试页面
- **路径**: `/test-aliyun-batch-prediction`
- **功能**: 完整的批量预测测试界面

## 🔧 使用步骤

### 第一步：访问测试页面
```
http://localhost:3000/test-aliyun-batch-prediction
```

### 第二步：准备成绩文件
确保Excel文件包含以下信息：
- **Current_Major** 或 **专业** 字段 - 学生所属专业（必需）
- **SNH** - 学生学号
- **Course_Name** - 课程名称
- **Grade** - 成绩
- 其他必要的成绩字段

### 第三步：上传文件和配置
- **上传文件**: 选择包含多专业学生的完整成绩文件
- **选择年级**: 2021-2024级（系统会显示该年级支持的专业）
- **设置并发**: 1-4个专业同时处理
- **无需选择专业**: 系统会自动识别文件中的所有专业

### 第四步：自动批量处理
系统会自动：
1. 读取Excel文件并解析数据
2. 智能识别文件中包含的所有专业
3. 按专业自动分组学生数据
4. 为每个专业生成单独的Excel文件
5. 并行调用阿里云预测API
6. 收集所有专业的预测结果

### 第五步：查看和下载结果
- 查看统计概览（总专业数、成功/失败数量等）
- 查看自动识别到的专业列表
- 下载各专业的详细预测结果Excel文件
- 查看错误信息（如有）

## 📊 支持的专业配置

### 2021级
- 物联网工程
- 电信工程及管理
- 电子商务及法律

### 2022级
- 智能科学与技术
- 物联网工程
- 电信工程及管理
- 电子信息工程

### 2023级
- 智能科学与技术
- 物联网工程
- 电信工程及管理
- 电子信息工程

### 2024级
- 智能科学与技术
- 物联网工程
- 电信工程及管理
- 电子信息工程

## ⚡ 性能优化特性

### 智能专业匹配
- 支持模糊匹配专业名称
- 自动过滤无效数据
- 智能分组算法

### 并发处理控制
- **1个专业**: 顺序处理，资源消耗最低
- **2个专业**: 推荐设置，平衡速度和稳定性
- **3-4个专业**: 高性能模式，处理速度最快

### 错误恢复机制
- 单个专业失败不影响其他专业
- 详细的错误信息和诊断
- 失败专业可单独重新处理

## 📈 工作流程图

```
上传包含多专业的成绩文件
     ↓
读取Excel数据并解析
     ↓
智能识别文件中的所有专业
     ↓
按专业自动分组学生数据
     ↓
为每个专业生成Excel文件
     ↓
并行调用阿里云预测API
     ↓
收集所有专业的预测结果
     ↓
生成统计报告和文件下载
```

## 🔍 数据处理详情

### 输入数据格式
```json
{
  "SNH": "学生学号",
  "Current_Major": "物联网工程",
  "Course_Name": "高等数学",
  "Grade": "85",
  "Course_Type": "必修",
  "Credit": "4"
}
```

### 分组后数据
```json
{
  "物联网工程": [
    {"SNH": "2021001", "Course_Name": "高等数学", "Grade": "85"},
    {"SNH": "2021002", "Course_Name": "高等数学", "Grade": "90"}
  ],
  "电信工程及管理": [
    {"SNH": "2021003", "Course_Name": "高等数学", "Grade": "88"}
  ]
}
```

### 输出结果格式
```json
{
  "summary": {
    "batchId": "batch_1234567890",
    "totalMajors": 4,
    "successfulMajors": 3,
    "failedMajors": 1,
    "totalStudents": 150
  },
  "results": [
    {
      "major": "物联网工程",
      "studentCount": 45,
      "result": {
        "statistics": {...},
        "results": {"Predictions": [...]}
      }
    }
  ],
  "errors": [
    {
      "major": "某专业",
      "error": "错误信息"
    }
  ]
}
```

## 📋 最佳实践

### 文件准备建议
1. **数据清洗**: 确保专业名称准确，无多余空格
2. **格式统一**: 使用标准的Excel格式(.xlsx)
3. **大小控制**: 建议单文件不超过50MB以提高处理速度
4. **备份原文件**: 处理前备份原始数据

### 性能优化建议
1. **合理并发**: 根据服务器性能选择并发数量
2. **分批处理**: 如果数据量很大，考虑分批上传
3. **网络稳定**: 确保网络连接稳定
4. **错误重试**: 失败的专业可以单独重新处理

### 故障排除
1. **专业匹配失败**: 检查专业名称是否在支持列表中
2. **文件读取错误**: 确认Excel文件格式正确
3. **预测API失败**: 检查阿里云服务器状态
4. **下载失败**: 清除浏览器缓存后重试

## 🎉 功能优势

### vs 单个预测
- **效率提升**: 一次处理整个年级，无需逐个专业操作
- **自动化识别**: 无需手动选择专业，系统自动识别和分组
- **数据统一**: 统一的数据源和处理标准
- **结果对比**: 可以横向比较各专业的预测结果

### vs 传统方式
- **完全自动化**: 无需手动分组、选择专业或多次上传
- **智能识别**: 自动从文件中识别所有专业并处理
- **错误处理完善**: 详细的错误信息和恢复机制
- **结果标准化**: 统一的输出格式和下载方式

---

**🎯 现在你可以高效地处理整个年级的学生去向预测了！**

如有任何问题，请参考错误信息或查看浏览器控制台的详细日志。
